<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      input {
        display: block;
        clear: both;
        margin: 10px 0;
      }
    </style>
  </head>

  <body>
    <h2>Planet Metadata Uploader</h2>

    <label for="uploadUrl">uploadUrl :</label>
    <input
      id="uploadUrl"
      autocomplete="off"
      value="http://localhost:3001/metadata"
    />

    <label for="tokenId">TokenId :</label>
    <input id="tokenId" autocomplete="off" value="1" />

    <label for="name">Name :</label>
    <input id="name" autocomplete="off" value="jupiter #1" />

    <label for="description">Description :</label>
    <input id="description" autocomplete="off" value="jupiter #1" />

    <label for="properties">Traits :</label><br />
    <textarea id="properties" autocomplete="off" style="width: 170px" rows="5">
[{"trait_type": "rarity","value": "normal"}]</textarea
    ><br />

    <label for="image">Image :</label>
    <input type="file" id="image" accept="image/*" />

    <button onclick="onSubmit();">submit</button>
    <div id="tokenURIs"></div>

    <div id="result"></div>

    <script>
      async function onSubmit() {
        try {
          const { uploadUrl, tokenId, name, description, propertiesJSON } =
            validateAndGetValue();

          await postData(uploadUrl, {
            tokenId,
            name,
            description,
            properties: propertiesJSON,
          });
        } catch (e) {
          console.log(e);
          alert(e.message);
        }
      }

      function validateAndGetValue() {
        const uploadUrl = document.getElementById("uploadUrl").value;
        if (!uploadUrl) {
          throw new Error("please fill in the `uploadUrl`");
        }
        const tokenId = document.getElementById("tokenId").value;
        if (!tokenId) {
          throw new Error("please fill in the `tokenId`");
        }
        const name = document.getElementById("name").value;
        if (!name) {
          throw new Error("please fill in the `name`");
        }
        const description = document.getElementById("description").value;
        if (!description) {
          throw new Error("please fill in the `description`");
        }
        const properties = document.getElementById("properties").value;
        let propertiesJSON = [];
        if (properties) {
          try {
            propertiesJSON = JSON.parse(properties);
          } catch (e) {
            throw new Error("`properties` cannot be convert to JSON");
          }
        }

        return { uploadUrl, tokenId, name, description, propertiesJSON };
      }

      async function postData(url = "", data = {}) {
        const response = await fetch(url, {
          method: "POST",
          mode: "cors",
          cache: "no-cache",
          credentials: "same-origin",
          headers: {
            "Content-Type": "application/json",
            // 'Content-Type': 'application/x-www-form-urlencoded',
          },
          redirect: "follow",
          referrerPolicy: "no-referrer",
          body: JSON.stringify(data),
        });
        return response.json();
      }

      // 获取填写数据
      //     const name = document.getElementById("demo-name").value;
      //     const description = document.getElementById("demo-des").value;
      //     const fileContent = document.getElementById("demo-image").files[0];
      //     if (!name || !description || !fileContent) {
      //       alert("please input ERC721 info!");
      //       return;
      //     }

      //     // 上传图片至 ipfs
      //     const imageResults = await node.add(fileContent);
      //     const imgUrl = `${basePath}/${imageResults.path}`;
      //     const metadata = {
      //       description,
      //       name,
      //       image: imgUrl,
      //     };

      //     // 上传 matedata
      //     const metadataResults = await node.add(JSON.stringify(metadata));
      //     // 创建元素并添加至 dom 节点中
      //     const tokenURIItemDom = document.createElement("a");
      //     const metadataResultsPath = `${basePath}${metadataResults.path}`;
      //     tokenURIItemDom.innerText = metadataResults.path;
      //     tokenURIItemDom.href = metadataResultsPath;
      //     tokenURIItemDom.target = "_blank";
      //     tokenURIItemDom.id = "url";
      //     const copyButton = document.createElement("button");
      //     copyButton.id = "copy";
      //     copyButton.innerText = "copy";
      //     document.getElementById("tokenURIs").innerHTML = "";
      //     document
      //       .getElementById("tokenURIs")
      //       .append(tokenURIItemDom, copyButton);
      //     document.getElementById("copy").addEventListener("click", () => {
      //       selectText("url");
      //     });
      //   }

      //   function selectText(element) {
      //     const text = document.getElementById(element);
      //     if (document.body.createTextRange) {
      //       const range = document.body.createTextRange();
      //       range.moveToElementText(text);
      //       range.select();
      //     } else if (window.getSelection) {
      //       const selection = window.getSelection();
      //       const range = document.createRange();
      //       range.selectNodeContents(text);
      //       selection.removeAllRanges();
      //       selection.addRange(range);
      //       document.execCommand("Copy");
      //     } else {
      //       alert("none");
      //     }
      //   }
    </script>
  </body>
</html>
